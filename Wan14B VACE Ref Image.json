{"last_node_id":201,"last_link_id":379,"nodes":[{"id":44,"type":"Note","pos":{"0":-1578.07373046875,"1":-1070.30078125},"size":{"0":303.0501403808594,"1":88},"flags":{},"order":0,"mode":4,"inputs":[],"outputs":[],"properties":{},"widgets_values":["If you have Triton installed, connect this for ~30% speed increase"],"color":"#432","bgcolor":"#653"},{"id":42,"type":"Note","pos":{"0":-1578.07373046875,"1":-900.3004760742188},"size":{"0":314.96246337890625,"1":152.77333068847656},"flags":{},"order":1,"mode":4,"inputs":[],"outputs":[],"properties":{},"widgets_values":["Adjust the blocks to swap based on your VRAM, this is a tradeoff between speed and memory usage.\n\nAlternatively there's option to use VRAM management introduced in DiffSynt-Studios. This is usually slower, but saves even more VRAM compared to BlockSwap"],"color":"#432","bgcolor":"#653"},{"id":36,"type":"Note","pos":{"0":-1048.07373046875,"1":-510.30133056640625},"size":{"0":374.3061828613281,"1":171.9547576904297},"flags":{},"order":2,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["fp8_fast seems to cause huge quality degradation\n\nfp_16_fast enables \"Full FP16 Accmumulation in FP16 GEMMs\" feature available in the very latest pytorch nightly, this is around 20% speed boost. \n\nSageattn if you have it installed can be used for almost double inference speed"],"color":"#432","bgcolor":"#653"},{"id":122,"type":"SetNode","pos":{"0":-722.2077026367188,"1":-279.24761962890625},"size":{"0":210,"1":60},"flags":{"collapsed":true},"order":21,"mode":0,"inputs":[{"name":"WANVAE","type":"WANVAE","link":247}],"outputs":[{"name":"*","type":"*","links":null}],"title":"Set_WanVAE","properties":{"previousName":"WanVAE"},"widgets_values":["WanVAE"],"color":"#322","bgcolor":"#533"},{"id":125,"type":"SetNode","pos":{"0":-658.54833984375,"1":-104.34416198730469},"size":{"0":210,"1":60},"flags":{"collapsed":true},"order":22,"mode":0,"inputs":[{"name":"WANTEXTENCODER","type":"WANTEXTENCODER","link":250}],"outputs":[{"name":"*","type":"*","links":null}],"title":"Set_WanTextEncoder","properties":{"previousName":"WanTextEncoder"},"widgets_values":["WanTextEncoder"],"color":"#432","bgcolor":"#653"},{"id":182,"type":"Note","pos":{"0":-599.452880859375,"1":-672.8222045898438},"size":{"0":344.17034912109375,"1":107.31356811523438},"flags":{},"order":3,"mode":0,"inputs":[],"outputs":[],"properties":{},"widgets_values":["While the WanVideo 1.3B model is in FP32, the VACE module in it is in BF16, so using fp16_fast is technically lossy, but seems to be fine if you want the speed boost."],"color":"#432","bgcolor":"#653"},{"id":39,"type":"WanVideoBlockSwap","pos":{"0":-1568.0738525390625,"1":-680.3004760742188},"size":{"0":315,"1":154},"flags":{},"order":4,"mode":4,"inputs":[],"outputs":[{"name":"block_swap_args","type":"BLOCKSWAPARGS","links":[],"slot_index":0}],"properties":{"Node name for S&R":"WanVideoBlockSwap","cnr_id":"ComfyUI-WanVideoWrapper","ver":"3869b0482b615b6a8fd6f346467c5ef6627eed72"},"widgets_values":[0,false,false,true,15],"color":"#223","bgcolor":"#335"},{"id":172,"type":"WanVideoSampler","pos":{"0":2049,"1":1327},"size":{"0":312.8956298828125,"1":804.8956298828125},"flags":{},"order":33,"mode":0,"inputs":[{"name":"model","type":"WANVIDEOMODEL","link":302},{"name":"text_embeds","type":"WANVIDEOTEXTEMBEDS","link":303},{"name":"image_embeds","type":"WANVIDIMAGE_EMBEDS","link":362},{"name":"samples","type":"LATENT","link":null,"shape":7},{"name":"feta_args","type":"FETAARGS","link":null,"shape":7},{"name":"context_options","type":"WANVIDCONTEXT","link":null,"shape":7},{"name":"teacache_args","type":"TEACACHEARGS","link":334,"shape":7},{"name":"flowedit_args","type":"FLOWEDITARGS","link":null,"shape":7},{"name":"slg_args","type":"SLGARGS","link":305,"shape":7},{"name":"loop_args","type":"LOOPARGS","link":null,"shape":7},{"name":"experimental_args","type":"EXPERIMENTALARGS","link":306,"shape":7},{"name":"sigmas","type":"SIGMAS","link":null,"shape":7},{"name":"unianimate_poses","type":"UNIANIMATE_POSE","link":null,"shape":7},{"name":"fantasytalking_embeds","type":"FANTASYTALKING_EMBEDS","link":null,"shape":7}],"outputs":[{"name":"samples","type":"LATENT","links":[298]}],"properties":{"Node name for S&R":"WanVideoSampler","cnr_id":"ComfyUI-WanVideoWrapper","ver":"2d2a184723dae88388e130659f51c36fcadeaba8"},"widgets_values":[20,4.000000000000001,5,18,"fixed",true,"unipc",0,1,false,"comfy"]},{"id":152,"type":"GetNode","pos":{"0":1841,"1":1309},"size":{"0":210,"1":58},"flags":{"collapsed":true},"order":5,"mode":0,"inputs":[],"outputs":[{"name":"WANVIDEOMODEL","type":"WANVIDEOMODEL","links":[302]}],"title":"Get_WanModel","properties":{},"widgets_values":["WanModel"],"color":"#223","bgcolor":"#335"},{"id":38,"type":"WanVideoVAELoader","pos":{"0":-1069.7734375,"1":-269.3061828613281},"size":{"0":315,"1":82},"flags":{},"order":6,"mode":0,"inputs":[],"outputs":[{"name":"vae","type":"WANVAE","links":[247],"slot_index":0}],"properties":{"Node name for S&R":"WanVideoVAELoader","cnr_id":"ComfyUI-WanVideoWrapper","ver":"3869b0482b615b6a8fd6f346467c5ef6627eed72"},"widgets_values":["Wan2_1_VAE_bf16.safetensors","bf16"],"color":"#322","bgcolor":"#533"},{"id":121,"type":"SetNode","pos":{"0":-596,"1":-759},"size":{"0":210,"1":60},"flags":{"collapsed":false},"order":27,"mode":0,"inputs":[{"name":"WANVIDEOMODEL","type":"WANVIDEOMODEL","link":246}],"outputs":[{"name":"*","type":"*","links":null}],"title":"Set_WanModel","properties":{"previousName":"WanModel"},"widgets_values":["WanModel"],"color":"#223","bgcolor":"#335"},{"id":11,"type":"LoadWanVideoT5TextEncoder","pos":{"0":-1058.68310546875,"1":-99.36381530761719},"size":{"0":377.1661376953125,"1":130},"flags":{},"order":7,"mode":0,"inputs":[],"outputs":[{"name":"wan_t5_model","type":"WANTEXTENCODER","links":[250],"slot_index":0}],"properties":{"Node name for S&R":"LoadWanVideoT5TextEncoder","cnr_id":"ComfyUI-WanVideoWrapper","ver":"3869b0482b615b6a8fd6f346467c5ef6627eed72"},"widgets_values":["umt5-xxl-enc-bf16.safetensors","bf16","offload_device","disabled"],"color":"#432","bgcolor":"#653"},{"id":150,"type":"WanVideoExperimentalArgs","pos":{"0":1501,"1":1890},"size":{"0":327.5999755859375,"1":226},"flags":{},"order":8,"mode":0,"inputs":[],"outputs":[{"name":"exp_args","type":"EXPERIMENTALARGS","links":[306]}],"properties":{"Node name for S&R":"WanVideoExperimentalArgs","cnr_id":"ComfyUI-WanVideoWrapper","ver":"2d2a184723dae88388e130659f51c36fcadeaba8"},"widgets_values":["",true,false,0,false,1,1.25,20]},{"id":166,"type":"GetNode","pos":{"0":2102,"1":1200},"size":{"0":210,"1":58},"flags":{"collapsed":false},"order":9,"mode":0,"inputs":[],"outputs":[{"name":"WANVAE","type":"WANVAE","links":[297]}],"title":"Get_WanVAE","properties":{},"widgets_values":["WanVAE"],"color":"#322","bgcolor":"#533"},{"id":167,"type":"WanVideoDecode","pos":{"0":2467,"1":1177},"size":{"0":315,"1":198},"flags":{},"order":34,"mode":0,"inputs":[{"name":"vae","type":"WANVAE","link":297},{"name":"samples","type":"LATENT","link":298}],"outputs":[{"name":"images","type":"IMAGE","links":[343]}],"properties":{"Node name for S&R":"WanVideoDecode","cnr_id":"ComfyUI-WanVideoWrapper","ver":"d9b1f4d1a5aea91d101ae97a54714a5861af3f50"},"widgets_values":[false,272,272,144,128],"color":"#322","bgcolor":"#533"},{"id":165,"type":"VHS_VideoCombine","pos":{"0":2897,"1":1217},"size":[605.903076171875,310],"flags":{},"order":35,"mode":0,"inputs":[{"name":"images","type":"IMAGE","link":343},{"name":"audio","type":"AUDIO","link":null,"shape":7},{"name":"meta_batch","type":"VHS_BatchManager","link":null,"shape":7},{"name":"vae","type":"VAE","link":null,"shape":7}],"outputs":[{"name":"Filenames","type":"VHS_FILENAMES","links":null}],"properties":{"Node name for S&R":"VHS_VideoCombine","cnr_id":"comfyui-videohelpersuite","ver":"0a75c7958fe320efcb052f1d9f8451fd20c730a8"},"widgets_values":{"frame_rate":16,"loop_count":0,"filename_prefix":"WanVideoWrapper_VACE_startendframe","format":"video/h264-mp4","pix_fmt":"yuv420p","crf":19,"save_metadata":true,"pingpong":false,"save_output":true,"videopreview":{"hidden":false,"paused":false,"params":{"filename":"WanVideoWrapper_VACE_startendframe_00001.mp4","subfolder":"","type":"output","format":"video/h264-mp4","frame_rate":16,"workflow":"WanVideoWrapper_VACE_startendframe_00007.png","fullpath":"N:\\AI\\ComfyUI\\temp\\WanVideoWrapper_VACE_startendframe_00007.mp4"}}}},{"id":142,"type":"GetNode","pos":{"0":1351,"1":1178},"size":{"0":210,"1":58},"flags":{"collapsed":false},"order":10,"mode":0,"inputs":[],"outputs":[{"name":"WANVAE","type":"WANVAE","links":[356],"slot_index":0}],"title":"Get_WanVAE","properties":{},"widgets_values":["WanVAE"],"color":"#322","bgcolor":"#533"},{"id":151,"type":"GetNode","pos":{"0":434,"1":840},"size":{"0":210,"1":58},"flags":{"collapsed":false},"order":11,"mode":0,"inputs":[],"outputs":[{"name":"WANVIDEOMODEL","type":"WANVIDEOMODEL","links":[300]}],"title":"Get_WanModel","properties":{},"widgets_values":["WanModel"],"color":"#223","bgcolor":"#335"},{"id":143,"type":"GetNode","pos":{"0":408,"1":952},"size":{"0":210,"1":58},"flags":{"collapsed":false},"order":12,"mode":0,"inputs":[],"outputs":[{"name":"WANTEXTENCODER","type":"WANTEXTENCODER","links":[299]}],"title":"Get_WanTextEncoder","properties":{},"widgets_values":["WanTextEncoder"],"color":"#432","bgcolor":"#653"},{"id":187,"type":"WanVideoVACEEncode","pos":{"0":1568,"1":1354},"size":{"0":355.20001220703125,"1":282},"flags":{},"order":31,"mode":0,"inputs":[{"name":"vae","type":"WANVAE","link":356},{"name":"input_frames","type":"IMAGE","link":null,"shape":7},{"name":"ref_images","type":"IMAGE","link":375,"shape":7},{"name":"input_masks","type":"MASK","link":null,"shape":7},{"name":"prev_vace_embeds","type":"WANVIDIMAGE_EMBEDS","link":null,"shape":7},{"name":"width","type":"INT","link":376,"widget":{"name":"width"}},{"name":"height","type":"INT","link":377,"widget":{"name":"height"}},{"name":"num_frames","type":"INT","link":378,"widget":{"name":"num_frames"}}],"outputs":[{"name":"vace_embeds","type":"WANVIDIMAGE_EMBEDS","links":[362],"slot_index":0}],"properties":{"Node name for S&R":"WanVideoVACEEncode"},"widgets_values":[832,480,81,1,0,1,false]},{"id":188,"type":"WanVideoVACEModelSelect","pos":{"0":-829,"1":-950},"size":{"0":327.5999755859375,"1":58},"flags":{},"order":13,"mode":0,"inputs":[],"outputs":[{"name":"vace_model","type":"VACEPATH","links":[364],"slot_index":0}],"properties":{"Node name for S&R":"WanVideoVACEModelSelect"},"widgets_values":["wan/Wan2_1-VACE_module_14B_fp8_e4m3fn.safetensors"]},{"id":198,"type":"easy int","pos":{"0":989,"1":1392},"size":[326.3329170612351,58],"flags":{},"order":14,"mode":0,"inputs":[],"outputs":[{"name":"int","type":"INT","links":[376],"slot_index":0}],"title":"width","properties":{"Node name for S&R":"easy int"},"widgets_values":[720],"color":"#432","bgcolor":"#653"},{"id":199,"type":"easy int","pos":{"0":989,"1":1494},"size":[326.3329170612351,58],"flags":{},"order":15,"mode":0,"inputs":[],"outputs":[{"name":"int","type":"INT","links":[377],"slot_index":0}],"title":"height","properties":{"Node name for S&R":"easy int"},"widgets_values":[720],"color":"#432","bgcolor":"#653"},{"id":197,"type":"ImageConcanate","pos":{"0":513,"1":1820},"size":{"0":315,"1":102},"flags":{},"order":30,"mode":0,"inputs":[{"name":"image1","type":"IMAGE","link":373},{"name":"image2","type":"IMAGE","link":374}],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[375,379],"slot_index":0}],"properties":{"Node name for S&R":"ImageConcanate"},"widgets_values":["right",true]},{"id":201,"type":"SaveImage","pos":{"0":619,"1":2159},"size":[315,270],"flags":{},"order":32,"mode":0,"inputs":[{"name":"images","type":"IMAGE","link":379}],"outputs":[],"properties":{},"widgets_values":["ComfyUI"]},{"id":147,"type":"WanVideoTeaCache","pos":{"0":1610.7760009765625,"1":1078.9632568359375},"size":{"0":315,"1":178},"flags":{},"order":16,"mode":0,"inputs":[],"outputs":[{"name":"teacache_args","type":"TEACACHEARGS","links":[334]}],"properties":{"Node name for S&R":"WanVideoTeaCache","cnr_id":"ComfyUI-WanVideoWrapper","ver":"3869b0482b615b6a8fd6f346467c5ef6627eed72"},"widgets_values":[0.10000000000000002,0,-1,"offload_device","true","e"]},{"id":149,"type":"WanVideoSLG","pos":{"0":1497,"1":1723},"size":{"0":315,"1":106},"flags":{},"order":17,"mode":0,"inputs":[],"outputs":[{"name":"slg_args","type":"SLGARGS","links":[305]}],"properties":{"Node name for S&R":"WanVideoSLG","cnr_id":"ComfyUI-WanVideoWrapper","ver":"2d2a184723dae88388e130659f51c36fcadeaba8"},"widgets_values":["9",0.30000000000000004,0.7000000000000002]},{"id":169,"type":"LoadImage","pos":{"0":-716,"1":1439},"size":{"0":292.45867919921875,"1":396.9063415527344},"flags":{},"order":18,"mode":0,"inputs":[],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[323,370],"slot_index":0},{"name":"MASK","type":"MASK","links":null}],"title":"Load Image: Reference","properties":{"Node name for S&R":"LoadImage","cnr_id":"comfy-core","ver":"0.3.27"},"widgets_values":["1747410858717_5月16日 (3)(1).jpg","image"]},{"id":192,"type":"LoadImage","pos":{"0":-761,"1":1996},"size":[315,314],"flags":{},"order":19,"mode":0,"inputs":[],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[369],"slot_index":0},{"name":"MASK","type":"MASK","links":null}],"properties":{"Node name for S&R":"LoadImage"},"widgets_values":["1747410874419_item_0000013462_NcUK551f_101.jpg","image"]},{"id":168,"type":"WanVideoTextEncode","pos":{"0":889,"1":957},"size":{"0":420.30511474609375,"1":261.5306701660156},"flags":{},"order":23,"mode":0,"inputs":[{"name":"t5","type":"WANTEXTENCODER","link":299},{"name":"model_to_offload","type":"WANVIDEOMODEL","link":300,"shape":7}],"outputs":[{"name":"text_embeds","type":"WANVIDEOTEXTEMBEDS","links":[303],"slot_index":0}],"properties":{"Node name for S&R":"WanVideoTextEncode","cnr_id":"ComfyUI-WanVideoWrapper","ver":"3869b0482b615b6a8fd6f346467c5ef6627eed72"},"widgets_values":["Iron Man and Hulk are fighting, punching and kicking each other, cosmic background, magnificent light, spectacular scene, 4K resolution.","bad quality, blurry, messy, chaotic",true],"color":"#432","bgcolor":"#653"},{"id":22,"type":"WanVideoModelLoader","pos":{"0":-1118,"1":-780},"size":{"0":477.4410095214844,"1":254},"flags":{},"order":24,"mode":0,"inputs":[{"name":"compile_args","type":"WANCOMPILEARGS","link":null,"shape":7},{"name":"block_swap_args","type":"BLOCKSWAPARGS","link":null,"shape":7},{"name":"lora","type":"WANVIDLORA","link":null,"shape":7},{"name":"vram_management_args","type":"VRAM_MANAGEMENTARGS","link":null,"shape":7},{"name":"vace_model","type":"VACEPATH","link":364,"shape":7},{"name":"fantasytalking_model","type":"FANTASYTALKINGMODEL","link":null,"shape":7}],"outputs":[{"name":"model","type":"WANVIDEOMODEL","links":[246],"slot_index":0}],"properties":{"Node name for S&R":"WanVideoModelLoader","cnr_id":"ComfyUI-WanVideoWrapper","ver":"3869b0482b615b6a8fd6f346467c5ef6627eed72"},"widgets_values":["Wan2_1-T2V-14B_fp8_e4m3fn.safetensors","bf16","disabled","offload_device","sageattn"],"color":"#223","bgcolor":"#335"},{"id":194,"type":"easy imageScaleDownToSize","pos":{"0":-256,"1":1460},"size":{"0":315,"1":82},"flags":{},"order":25,"mode":0,"inputs":[{"name":"images","type":"IMAGE","link":370}],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[372],"slot_index":0}],"properties":{"Node name for S&R":"easy imageScaleDownToSize"},"widgets_values":[720,true]},{"id":193,"type":"easy imageScaleDownToSize","pos":{"0":-264,"1":2013},"size":{"0":315,"1":82},"flags":{},"order":26,"mode":0,"inputs":[{"name":"images","type":"IMAGE","link":369}],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[371],"slot_index":0}],"properties":{"Node name for S&R":"easy imageScaleDownToSize"},"widgets_values":[720,true]},{"id":195,"type":"RMBG","pos":{"0":119,"1":1995},"size":{"0":315,"1":270},"flags":{},"order":29,"mode":0,"inputs":[{"name":"image","type":"IMAGE","link":371}],"outputs":[{"name":"image","type":"IMAGE","links":[374],"slot_index":0},{"name":"mask","type":"MASK","links":null}],"properties":{"Node name for S&R":"RMBG"},"widgets_values":["RMBG-2.0",1,736,0,0,"white",false,"default",false]},{"id":196,"type":"RMBG","pos":{"0":175,"1":1432},"size":{"0":315,"1":270},"flags":{},"order":28,"mode":0,"inputs":[{"name":"image","type":"IMAGE","link":372}],"outputs":[{"name":"image","type":"IMAGE","links":[373],"slot_index":0},{"name":"mask","type":"MASK","links":null}],"properties":{"Node name for S&R":"RMBG"},"widgets_values":["RMBG-2.0",1,736,0,0,"white",false,"default",false]},{"id":200,"type":"easy int","pos":{"0":994,"1":1601},"size":[326.3329170612351,58],"flags":{},"order":20,"mode":0,"inputs":[],"outputs":[{"name":"int","type":"INT","links":[378],"slot_index":0}],"title":"num_frames","properties":{"Node name for S&R":"easy int"},"widgets_values":[57],"color":"#432","bgcolor":"#653"}],"links":[[246,22,0,121,0,"*"],[247,38,0,122,0,"*"],[250,11,0,125,0,"*"],[297,166,0,167,0,"WANVAE"],[298,172,0,167,1,"LATENT"],[299,143,0,168,0,"WANTEXTENCODER"],[300,151,0,168,1,"WANVIDEOMODEL"],[302,152,0,172,0,"WANVIDEOMODEL"],[303,168,0,172,1,"WANVIDEOTEXTEMBEDS"],[305,149,0,172,8,"SLGARGS"],[306,150,0,172,10,"EXPERIMENTALARGS"],[334,147,0,172,6,"TEACACHEARGS"],[343,167,0,165,0,"IMAGE"],[356,142,0,187,0,"WANVAE"],[362,187,0,172,2,"WANVIDIMAGE_EMBEDS"],[364,188,0,22,4,"VACEPATH"],[369,192,0,193,0,"IMAGE"],[370,169,0,194,0,"IMAGE"],[371,193,0,195,0,"IMAGE"],[372,194,0,196,0,"IMAGE"],[373,196,0,197,0,"IMAGE"],[374,195,0,197,1,"IMAGE"],[375,197,0,187,2,"IMAGE"],[376,198,0,187,5,"INT"],[377,199,0,187,6,"INT"],[378,200,0,187,7,"INT"],[379,197,0,201,0,"IMAGE"]],"groups":[{"title":"Control with Reference","bounding":[-154,903,3673,1979],"color":"#3f789e","font_size":24,"flags":{}},{"title":"Models","bounding":[-1655,-1214,1398,1329],"color":"#88A","font_size":24,"flags":{}}],"config":{},"extra":{"ds":{"scale":0.3452271214393113,"offset":[271.3287172740495,-187.01420893073055]},"node_versions":{"ComfyUI-WanVideoWrapper":"5a2383621a05825d0d0437781afcb8552d9590fd","comfy-core":"0.3.26","ComfyUI-VideoHelperSuite":"0a75c7958fe320efcb052f1d9f8451fd20c730a8"},"VHS_latentpreview":true,"VHS_latentpreviewrate":0,"VHS_MetadataImage":true,"VHS_KeepIntermediate":true},"version":0.4}